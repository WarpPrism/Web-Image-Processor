function HCI(){var t=document.getElementById("file"),a=document.getElementById("openBtn");addHandler(a,"click",function(){t.click()},!1),t.onchange=function(){getFilePath(G.img,this,null),G.img.onload=function(){imread(G.img)}},$("#rBtn").click(function(){showRedImg(G),getNewImgData(),drawNewChart()}),$("#gBtn").click(function(){showGreenImg(G),getNewImgData(),drawNewChart()}),$("#bBtn").click(function(){showBlueImg(G),getNewImgData(),drawNewChart()})}function getHistogramData(t,a){var e,n;switch("src"==a?n=G:"new"==a&&(n=NewImg),t){case"r":e=n.R_channel;break;case"g":e=n.G_channel;break;case"b":e=n.B_channel}var i,g,r=new Array(256);for(i=0;i<r.length;i++)r[i]=0;for(i=0;i<e.length;i++)g=e[i],r[g]++;for(i=0;256>i;i++)r[i]=r[i]/e.length,r[i]=1==r[i]?0:r[i];return r}function drawSrcChart(){var t=getHistogramData("r","src"),a=getHistogramData("g","src"),e=getHistogramData("b","src");$("#histogram").highcharts({chart:{type:"column"},title:{text:"原图RGB三通道直方图"},subtitle:{text:"某灰度值占整幅图像的比例"},xAxis:{categories:[],crosshair:!0},yAxis:{min:0,title:{text:"所占比例"}},tooltip:{headerFormat:'<span style="font-size:10px">灰度值：{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.5f}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"red",data:t,color:"#FF0000"},{name:"green",data:a,color:"#00FF00"},{name:"blue",data:e,color:"#0000FF"}]})}function drawNewChart(){var t=getHistogramData("r","new"),a=getHistogramData("g","new"),e=getHistogramData("b","new");$("#histogram2").highcharts({chart:{type:"column"},title:{text:"处理后RGB三通道直方图"},subtitle:{text:"某灰度值占整幅图像的比例"},xAxis:{categories:[],crosshair:!0},yAxis:{min:0,title:{text:"所占比例"}},tooltip:{headerFormat:'<span style="font-size:10px">灰度值：{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.5f}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"red",data:t,color:"#FF0000"},{name:"green",data:a,color:"#00FF00"},{name:"blue",data:e,color:"#0000FF"}]})}function getRChannel(t){var a=[];null===t.img_data&&console.log("No ImageData");for(var e=0;e<t.img_data.data.length;e+=4)a.push(t.img_data.data[e]);return a}function getGChannel(t){var a=[];null===t.img_data&&console.log("No ImageData");for(var e=1;e<t.img_data.data.length;e+=4)a.push(t.img_data.data[e]);return a}function getBChannel(t){var a=[];null===t.img_data&&console.log("No ImageData");for(var e=2;e<t.img_data.data.length;e+=4)a.push(t.img_data.data[e]);return a}function showRedImg(t){for(var a=getRChannel(t),e=G.cxt.createImageData(G.img_width,G.img_height),n=[],i=0,g=0;i<G.img_data_length;i+=4,g++)n[i]=a[g],n[i+1]=0,n[i+2]=0,n[i+3]=255;e.data.set(n),G.cxt.clearRect(0,0,G.canvas.width,G.canvas.height),G.cxt.putImageData(e,0,0,0,0,G.img_width,G.img_height)}function showGreenImg(t){for(var a=getGChannel(t),e=G.cxt.createImageData(G.img_width,G.img_height),n=[],i=0,g=0;i<G.img_data_length;i+=4,g++)n[i]=0,n[i+1]=a[g],n[i+2]=0,n[i+3]=255;e.data.set(n),G.cxt.clearRect(0,0,G.canvas.width,G.canvas.height),G.cxt.putImageData(e,0,0,0,0,G.img_width,G.img_height)}function showBlueImg(t){for(var a=getBChannel(t),e=G.cxt.createImageData(G.img_width,G.img_height),n=[],i=0,g=0;i<G.img_data_length;i+=4,g++)n[i]=0,n[i+1]=0,n[i+2]=a[g],n[i+3]=255;e.data.set(n),G.cxt.clearRect(0,0,G.canvas.width,G.canvas.height),G.cxt.putImageData(e,0,0,0,0,G.img_width,G.img_height)}function addHandler(t,a,e){t.addEventListener?t.addEventListener(a,e,!1):t.attachEvent?t.attachEvent("on"+a,e):t["on"+a]=e}function resizeCanvas(t,a){G.canvas.width=t,G.canvas.height=a}function getFilePath(t,a,e){if(window.navigator.userAgent.indexOf("MSIE")>=1){t.select();var n=document.selection.createRange().text;t.removeAttribute("src"),t.setAttribute("src",e),t.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+n+"', sizingMethod='scale');"}else{var i=a.files[0],g=new FileReader;g.onload=function(a){t.setAttribute("src",a.target.result)},g.readAsDataURL(i)}}function imread(t){G.cxt.clearRect(0,0,G.canvas.width,G.canvas.height);var a=t.width,e=t.height;resizeCanvas(a,e),G.cxt.drawImage(t,0,0,a,e),G.img_data=G.cxt.getImageData(0,0,G.canvas.width,G.canvas.height),G.img_width=G.img_data.width,G.img_height=G.img_data.height,G.img_data_length=G.img_width*G.img_height*4,G.R_channel=getRChannel(G),G.G_channel=getGChannel(G),G.B_channel=getBChannel(G),G.img_type="彩色图像";for(var n=0;100>n;n++)G.R_channel[n]===G.B_channel[n]&&G.B_channel[n]===G.G_channel[n]&&(G.img_type="灰度图像");drawSrcChart(),makeTable()}function makeTable(){way.set("myTableData",{image_type:G.img_type,total_pixel:G.img_data_length,width:G.img_width+"px",height:G.img_height+"px"})}function getNewImgData(){NewImg.img_data=G.cxt.getImageData(0,0,G.canvas.width,G.canvas.height),NewImg.img_width=NewImg.img_data.width,NewImg.img_height=NewImg.img_data.height,NewImg.img_data_length=NewImg.img_width*NewImg.img_height*4,NewImg.R_channel=getRChannel(NewImg),NewImg.G_channel=getGChannel(NewImg),NewImg.B_channel=getBChannel(NewImg)}var G={name:"Global Space"};G.canvas=document.getElementById("canvas"),G.cxt=G.canvas.getContext("2d"),G.img=new Image,G.img_data=null,G.img_width=0,G.img_height=0,G.img_data_length=0,G.img_type=null,G.R_channel=null,G.G_channel=null,G.B_channel=null;var NewImg={img_data:null,img_width:0,img_height:0,img_data_length:0,R_channel:null,G_channel:null,B_channel:null};$(function(){G.img.src="./example.jpg",G.img.onload=function(){imread(G.img)},HCI()}());